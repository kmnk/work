# progress-3dgrowth

- [SlimDX Documentation](https://slimdx.org/docs/html/N_SlimDX_Direct3D11.htm)

- __done__ DirectX の実行環境を整えてビルドを出力する
- __done__ P/Invoke 法を調べる
    - 既定のインターフェース通りに定義したメソッドと状態を受け取るメッセージを定義して、そのメソッドの戻り値でアイドル状態かを判別して Draw するみたいな感じか
- __done__ Run のインターフェースを調べる
    - 特に無し
- __done__ FPS制御する
    - `System.Diagnostics.Stopwatch.GetTimestamp()` を用いてみる
    - やっぱり Ticks を用いる
    - Ticks が 100ナノ 秒であることを勘違いしてバグっていた。なんとかなった
- __done__ 三角ポリゴンの描画
    - Shader をバイナリに入れて参照するやり方が分からず断念。 zip をアップロードした
    - OKだった
- __done__ 提出OKはもらったが、ループ自体は潰していないので CPU を使いすぎているので、物理的に待つようにしたほうが良いと言われた。ので対応する
    - しかしこれ大洞さん自分で解決してるのかな。すごい
    - 本当は async/await とか使ったほうがきれいに書けるのだろうか
        - Delay を使うということはそういうことだった
    - この Draw ちゃんと動いてる？描画のための変数渡せていないが。 Pump って結局なんだったっけ
    - とりあえず背景の描画はできた。が、 60FPS 制限をとっぱらってしまった。もう一度 async/await で実装を試みる必要がある
    - async/await で実装できるイメージがなかったので、 Loop の中で Sleep するようにした
- __done__  DirectInput で回転させる
    - input 中に回転させる、はできたが、 time を使ったままなのでワープしてしまう
    - 現在の値を保持して、それに diff を加算するようにし、それを参照するようにすればできるはず
    - 対応した。次の課題の内容をみるに、カメラを回転するのは邪道な可能性が出てきた
- __done__ マウスで回転させる
    - DirectInput でマウスの動きを取ることはできた
    - 回転は Quaternion 周りを使わないとダメそう。この辺りを読んで追加実装が必要
        - https://qiita.com/kenjihiranabe/items/945232fbde58fab45681
        - https://slimdx.org/docs/html/M_SlimDX_Vector3_Transform_3.htm
        - https://slimdx.org/docs/html/T_SlimDX_Quaternion.htm
    - 余計な事を考えてたかもしれない。 [この記事](http://memeplex.blog.shinobi.jp/directx11/c-%E3%81%A7directx11%20slimdx%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB%E3%81%9D%E3%81%AE07%20%E3%82%AB%E3%83%A1%E3%83%A9%EF%BC%88%E9%81%A0%E8%BF%91%E6%84%9F%EF%BC%8B%E5%9B%9E%E8%BB%A2%EF%BC%89) の応用で解けそう？
    - 若干 Y軸 の角度がきつい時に変な動きをしている気がするが、とりあえずできた。提出
- __done__ テクスチャーを貼る
    - 基本的に [これでいいはず](http://memeplex.blog.shinobi.jp/directx11/c-%E3%81%A7directx11%20slimdx%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB%E3%81%9D%E3%81%AE11%20%E3%83%86%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3) 読んで真似る
    - リソースから取得して、 Texture2D に変換してをする方法は [これ](http://schroedinger.tea-nifty.com/blog/2016/02/texture2d-7188.html) を真似た
    - 微妙に頂点の位置が違ったので調整して完成。提出した
- __done__ インデックスバッファー
    - まずは [これ](http://t01a.dtiblog.com/blog-entry-137.html) を読んでみている
    - [これ](https://stackoverflow.com/questions/4984738/slimdx-direct3d-11-indexing-problems) を読んで見る
    - [あとはこれ](https://qiita.com/JI1LDG/items/457e76ae15da214c8004)
    - 途中までできた気がしたのだけれど、描画されないのでなにか間違ってる
        - [このあたり](https://slimdx.org/docs/html/M_SlimDX_Direct3D11_InputAssemblerWrapper_SetIndexBuffer.htm) を読みつつ、APIの理解をしながら続きをやる
    - http://catalina1344.hatenablog.jp/entry/2017/05/26/215904 のツールを勧められたので試す
        - インストールなのか起動なのかよくわからないができず、挫折した
    - 井村さんのアドバイスどおり `自分がインデックスバッファにハマったときはSetIndexBufferの第二引数にFormat.R16_UIntを指定したら描画されなくてR32_UInt指定したら描画されました` をやったら、思ったように動くようになった。が、コレはどういうことなんだというのが分かってないので、後で確認しないと
- __done__ SetIndexBuffer の引数について調べる
    - index buffer 内のデータのフォーマットを指定する、とある
    - index buffer のデータはどうだったか？
        - uint ?
    - `R16_UInt` と `R32_UInt` との違いは？
    - おそらくこれと同等
        - DXGI_FORMAT_R32_UINT: 1 成分、32 ビット符号なし整数フォーマットです。
        - DXGI_FORMAT_R16_UINT: 1 成分、16 ビット符号なし整数フォーマットです。
    - `c#` の uint はどっち？
        - https://docs.microsoft.com/ja-jp/dotnet/csharp/language-reference/keywords/uint
            - 符号なし 32 ビット整数
    - 理解した
    - 参考にしていた https://qiita.com/JI1LDG/items/457e76ae15da214c8004 は PMD のインデックスが https://github.com/hangingman/wxMMDViewer/wiki/PMD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%BD%A2%E5%BC%8F%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6 より2バイトなので、 16 でよかった
- __done__ 現在の実装の見直し、把握、リファクタリングをしつつ動作保証
    - InitVertexBuffer は可変にできるようにしないと
    - 併せて InitIndexBuffer も
    - InitTexture は変数にリソース名を渡すなどは合ってもよいか？ただ、多分今後必要なくなるので放置でも良さそう
    - InitSquareInputAssembler, DrawSquare は Triangle をコピペして改造したので、どう動かしたいかを考えて変数を取れるようにしたい
    - クラス分けはどうする？まだこのままで良い？
        - ここまで書いた各メソッドにデータ定義をパラメーターとして渡して動くようにしたいか
    - 一旦このへんまでやる
    - 今は LoadContent で頂点情報最初に作っているが、再生中に後からグラフィック追加する的なことをする場合はどうやるんだろう？
        - たぶんそのうち後で必要になる
    - vertex buffer と index buffer は 1 : 1 ではあるので、併せて持ったクラス定義で良いのでは？
        - 途中までやった。もうちょっと進めたら課題の進捗を出していく
        - 家で環境つくれたら家でやっても良いかも
    - 一応分けた
- __done__ キューブを描画する
    - とりあえず座標手打ちで完了
    - 多分カメラが上下反転している気がする
- __done__ スフィアを描画する
    - 座標の計算とソレに応じたインデックスを計算する必要がある
    - 要参考: http://www.richardssoftware.net/2013/07/shapes-demo-with-direct3d11-and-slimdx.html
    - なんとなく雰囲気だけ作ってロジックが 0 の状態にした。明日時間があればチョット進める
    - ほぼ球になったのだが、以下ができてない。明日やる
        - 球が閉じていない。 S 型の溝ができている
        - テクスチャーが 2周 せず、一周で留まっている。サンプルは2周しているので、UVを周回させる必要がある
    - もうちょっとなのだが、何かがおかしい
        - おそらく球の描画の表面が逆になっている。描画順を逆にすると正しく回転ができる
        - 一番頭の部分がうまく描画できていない。原点に収束してしまっている
    - とりあえず UV 展開がだめな気がするけど、一旦出来たので提出
- __done__ カプセルを描画する
    - 円柱部の計算をプラオンするところをちゃんと考えられていなかった
        - Y軸だけ考えればよいかと思っていたが、 X, Z 軸も調整しないと狭まっていってしまう
    - とりあえずカプセル型に何かが表示されるようになったが、テクスチャーとか裏表とかがおかしい
        - 全部裏表がおかしい？
    - 円柱部分の計算が逆転していた。一応できたか？提出してしまおう
- __done__ デバッグ描画
    - ワイヤーフレーム描画？球描画して設定切り替えるだけなのでは。違うのか
        - あ、そもそも動的な設定じゃなかったような。ということは両方描画して動的に切り替える？
    - 参考: http://memeplex.blog.shinobi.jp/directx11/c-%E3%81%A7directx11%20slimdx%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB%E3%81%9D%E3%81%AE12%20%E3%83%AF%E3%82%A4%E3%83%A4%E3%83%BC%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0
    - サンプル見たら最上部＆最下部行は三角形だけで描画しているっぽいので、ちゃんとやらないとだめかもしれない
    - 色々試したが、どれもうまく行かず、検索している
    - 切り替えは途中で Solid / Wireframe を切り替えて、その後描画して、また戻す、という感じでやるとうまくいきそう
    - Vertex にテクスチャーとかの情報を載せてしまっているので、 Wireframe として表示する場合は別の Vetex array を用意しないとだめ？でも同じ形だからもったいない感じが
    - 後から Vertex を加工して描画ってできる？
    - ぐぐっていたら大庭さんのブログがヒットした
    - 端の処理を修正した後、境界のuv座標でなやんだが、手本を見たら反転して使っていた。なるほどなー
    - color と texture の掛け合わせを追加した。緑の表示が可能に
    - Wireframe はダブルで描画かなぁ
- __done__ Lambertライティング
    - とりあえず光の入力方法をいつものサンプルを眺めて把握する
    - それぞれシェーダー側に float3 で変数を用意して受けられるようにすれば、あとは渡して計算するだけかも
    - ライトの方向がおかしい？ dot が逆なんだろうか
    - ひとまず完了
- __done__ Ambientライティング
    - Ambient Color を持ってかけるか
    - 足し算するだけっぽい？対応した
- __done__ Blinn Phongライティング
    - これは計算して上乗せするだけか？
    - ハーフベクトルをどうやって頂点バッファーにのせるのか？
        - セマンティクスをソースコード側で指定していなかったので、不整合が起きていただけだった
    - MVP変換がうまく行っていない気がする
    - ベクトルの計算が全然うまく行かないので、この前の解答で正解として返ってくるか待ってみてみ良いかも
    - MVP変換とか、カメラの位置とか、ちゃんと出来ていない気がする
        - でも、 Position を World 座標にすると、カメラの位置が変わらないから全然違うところに移動してしまう気がする。どうするんだろう
    - そもそも World に値が入っていない気がする。なんだこれは
        - 無が入っていた気がする。消した
    - カメラの位置はどこに？それこそ World に入れておくべき値か？
    - 入れてみたが、どうも上手くいかない
    - 色々入れている値や計算を見直して整理したら割と良さげになった。見本とは違うが一旦これで提出して様子見してみる
    - OKをもらった
- しばらくつけていなかったが、課題達成を諦めた 2019.02.28
- __todo__ 振り返りをして今後につなげる
